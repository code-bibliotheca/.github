# Clean Code 7-9장

## 7. 오류 처리

- 오류 처리는 소프트웨어의 안정성과 신뢰성을 위해 매우 중요하다.
- 오류 처리는 장애 상황에서 예측 가능하고 적절한 대응을 할 수 있도록 해야 한다.

### 오류 코드보다 예외를 사용하라

- 오류 처리를 위해 오류 코드 대신 예외를 사용하는 것이 좋다.
- 예외를 사용하면 코드의 가독성이 높아지고, 오류 처리 로직을 명확하게 분리할 수 있다.

### Try-Catch-Finally 문부터 작성하라

[try-catch-finally](https://www.notion.so/try-catch-finally-b531f99e9bcc430695909d0c285941c4?pvs=21)

- 예외 처리 코드는 정상적인 코드 흐름과 분리되어 작성되어야 한다.
- 따라서 Try-Catch-Finally 문을 먼저 작성하고, 그 다음에 정상적인 코드를 작성하는 것이 바람직하다.

먼저 강제로 예외를 일으키는 테스트 케이스를 작성한 후 테스트를 통과하게 코드를 작성하는 방법을 권장한다. 그러면 자연스럽게 try 블록의 트랜잭션 범위부터 구현하게 되므로 범위 내에서 트랜잭션 본질을 유지하기 쉬워진다.

### 미확인 예외를 사용하라

- 확인된 예외(checked exception)는 예외 처리 코드를 강제하지만, 미확인 예외(unchecked exception)는 예외 처리를 강제하지 않는다.
- 따라서 미확인 예외를 사용하면 예외 처리 코드의 부담을 줄일 수 있다.

확인된 예외는 초기에는 멋진 아이디어로 여겨졌지만 현재는 필요하지 않은 경우가 많다. 이유는 확인된 예외가 OCP를 위반하고 캡슐화를 깨뜨릴 수 있기 때문이다. 대부분의 일반적인 애플리케이션에서는 의존성에 따른 비용이 이익보다 크므로 확인된 예외를 사용할 필요가 없다. 다만, 중요한 라이브러리 작성 시에는 모든 예외를 처리해야 하므로 확인된 예외가 유용할 수 있다.

### 예외에 의미를 제공하라

- 예외를 던질 때는 예외에 대한 충분한 정보를 포함해야 한다.
- 예외 메시지를 통해 어떤 오류가 발생했는지 명확하게 전달해야 한다.

### 호출자를 고려해 예외 클래스를 정의하라

- 오류를 분류하는 방법은 다양하며, 오류가 발생한 위치로 분류하거나 유형으로 분류할 수 있다.
- 프로그래머에게 가장 중요한 관심사는 오류를 잡아내는 방법이다.
- 예외 처리 코드에서 중복이 많을 수 있으나, 대부분의 경우 오류 처리 방식은 비슷하다.
- 중복을 줄이기 위해 호출하는 라이브러리 API를 감싸는 방법을 사용할 수 있다.
- 감싸기 클래스를 사용하면 외부 API와 프로그램 사이의 의존성이 줄어들며, 테스트하기도 쉬워진다.
- 감싸기 기법을 사용하면 특정 업체가 API를 설계한 방식에 영향을 받지 않고 프로그램을 작성할 수 있다.
- 예외 클래스를 적절히 사용하면 오류를 구분하고 처리하는데 유용하다

### 정상 흐름을 정의하라

- 오류 처리 코드보다는 정상 흐름의 코드를 먼저 작성해야 한다.
- 정상 흐름을 명확하게 정의하고, 오류 처리는 예외 상황에 대비한 추가적인 로직으로 작성해야 한다.

특수 사례 패턴을 적용하면, 예외 처리를 대신해서 특수한 상황에 대한 처리를 객체나 클래스 내부로 캡슐화한다. 예제에서는 PerDiemMealExpenses 클래스를 통해 청구한 식비가 없는 경우에 대한 처리를 담당한다. 이렇게 함으로써 클라이언트 코드는 예외 처리를 신경쓰지 않고, 단순히 반환된 객체를 사용하여 계산을 진행할 수 있다.

결과적으로, 코드가 더 간결해지고 예외 처리와 비즈니스 논리가 분리되어 유지보수와 가독성이 향상된다. 특수 사례 패턴은 예외 처리를 필요로하는 상황에서 중단되지 않고도 적절한 처리를 할 수 있는 유용한 방법 중 하나이다.

### null을 반환하지 마라

- null을 반환하는 것은 코드의 가독성을 떨어뜨리고 오류 처리를 복잡하게 만든다.
- null 대신에 예외를 던지거나 특정한 값을 반환하는 것이 좋다.

### null을 전달하지 마라

- 메소드에 null을 전달하는 것은 예상치 못한 오류를 발생시킬 수 있다.
- null을 전달할 수 없도록 인터페이스 설계나 메소드 시그니처를 명확하게 해야 한다.

⇒ 내가 짠 코드의 결과를 예상하지 못하는게 얼마나 바보같은 일인가 ㅎㅎ.. 오류처리보다 예외처리를 하는것은 어쩌면 사용자입장에서도 중요한 부분이 아닐까 생각한다. ‘오류가 발생했습니다.’보다는 ‘로그인에서 문제가 생겼습니다. 다시시도해주세요’같이 시도해볼 방안을 제시하는것이 UX적으로 좋다고 들었는데 코드에서도 (물론 다른 관점이지만..!) 고려를 해야겠구나 생각했다!

## 8. 경계

### 외부 코드 사용하기

외부 코드를 사용할 때는 명확한 경계를 설정하고 적절히 살피며 사용해야 한다.

### 경계 살피고 익히기

외부 코드를 적용하기 전에 먼저 그 코드를 완벽히 이해해야 한다. 문서를 잘 찾아보고, 샘플 코드를 실행해보며, 익히는 과정이 중요하다.

### log4j 익히기

log4j는 로깅 라이브러리로, 로그를 기록하는데 사용된다. 외부 라이브러리를 사용할 때, 해당 라이브러리의 특성과 설정을 잘 익혀야 한다.

### 학습 테스트는 공짜 이상이다

외부 라이브러리를 학습하기 위한 간단한 테스트 코드를 작성하는 것은 큰 가치가 있다. 이를 학습 테스트라고 하는데, 이는 사용법을 익히고 예상 동작을 검증하는데 도움을 준다.

### 아직 존재하지 않는 코드를 사용하기

아직 존재하지 않는 코드를 사용하는 것은 유용하다. 이렇게 하면 해당 코드를 사용하기 위한 인터페이스를 정의하게 되고, 그 인터페이스를 기반으로 개발이 가능해진다.

### 깨끗한 경계

경계를 깔끔하게 관리하는 것이 중요하다. 외부 코드와의 인터페이스를 단순하고 명확하게 유지하며, 필요한 경우 감싸는 형태로 구성하여 내부에 더럽히지 않도록 해야한다.

⇒ 쉽게 구현하려고 라이브러리를 쓴 적이 많은데 라이브러리도 학습해야하는 부분이 많았다. 라이브러리를 사용하기 위해서 이 기능을 만드는건 아니지만 냅다 바로 꽂은적이 많은데 직접적으로 쓰기보다 감싸는 형태로 사용해야한다는 것을 알았다.

## 9. 단위 테스트

### TDD 법칙 세 가지

TDD(Test-Driven Development)는 테스트를 먼저 작성하고 그 테스트를 통과하는 코드를 개발하는 방식이다.

- TDD의 세 가지 법칙:
  1. 실패하는 단위 테스트를 작성하기 전까지는 실제 코드를 작성하지 않는다.
  2. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
  3. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

### 깨끗한 테스트 코드 유지하기

- 테스트 코드도 실제 코드와 마찬가지로 깨끗하고 읽기 쉬워야 한다.
- 테스트 코드를 유지보수하기 쉽게 만들고, 가독성을 높이기 위해 적절한 네이밍과 구조를 사용해야 한다.

### 테스트는 유연성, 유지보수성, 재사용성을 제공한다.

- 단위 테스트는 소프트웨어의 유연성과 유지보수성을 향상시키며, 재사용 가능한 코드를 작성하는데 도움을 준다.
- 테스트를 통해 변경사항에 대한 안전망을 구축하고, 기능 추가나 버그 수정에 대한 자신감을 얻을 수 있다.

### 깨끗한 테스트 코드

- 깨끗한 테스트 코드는 가독성, 명확성, 간결성을 갖춰야 한다.
- 테스트 코드는 다른 개발자들이 쉽게 이해하고 수정할 수 있어야 하며, 실패한 테스트의 원인을 빠르게 파악할 수 있어야 한다.

### 도메인에 특화된 테스트 언어

- 테스트 코드를 작성할 때는 도메인에 특화된 언어를 사용하는 것이 좋다.
- 테스트 코드가 도메인 전문가와 협업하기 쉬워지고, 의사소통과 이해를 높일 수 있다.

### 이중 표준

- 테스트 코드에도 일정한 품질 기준이 적용되어야 한다.
- 실제 코드와 마찬가지로 테스트 코드도 깨끗하고 유지보수 가능해야 한다.

### 테스트당 assert 하나

- 단위 테스트에서는 각 테스트마다 하나의 개념만을 테스트해야 한다.
- 각 테스트 케이스에서는 한 개념에 대해 하나의 assert 문만 사용하는 것이 좋다.

### 테스트당 개념 하나

- 단위 테스트는 각 테스트마다 하나의 개념만을 테스트해야 한다.
- 여러 개념을 한 번에 테스트하는 것은 테스트의 목적과 의도를 알기 어렵게 만들고, 테스트 코드의 유지보수를 어렵게 한다.

### F.I.R.S.T.

- 테스트 코드는 F.I.R.S.T. 원칙을 따라야 한다.
- F: Fast(빠르게 실행되어야 한다)
- I: Independent(독립적으로 실행되어야 한다)
- R: Repeatable(반복 가능해야 한다)
- S: Self-Validating(스스로 검증 가능해야 한다)
- T: Timely(적시에 작성되어야 한다)

⇒ TDD.. 많이 들어보긴했는데 자세한 개념은 처음 알게되었다. 나쁘고 못된 건 다하고 있는 나 ^^.. 를 반성하며 하나씩 고쳐나가보자!
